<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.imzhitu.admin.trade.item.mapper.ItemMapper">

	<resultMap id="ItemMap" type="com.imzhitu.admin.trade.item.pojo.Item">
		<id column="id" property="id" javaType="java.lang.Integer"/>
		<result column="name" property="name" javaType="java.lang.String"/>
		<result column="summary" property="summary" javaType="java.lang.String"/>
		<result column="description" property="description" javaType="java.lang.String"/>
		<result column="world_id" property="worldId" javaType="java.lang.Integer"/>
		<result column="img_path" property="imgPath" javaType="java.lang.String"/>
		<result column="img_thumb" property="imgThumb" javaType="java.lang.String"/>
		<result column="price" property="price" javaType="java.math.BigDecimal"/>
		<result column="sale" property="sale" javaType="java.math.BigDecimal"/>
		<result column="sales" property="sales" javaType="java.lang.Integer"/>
		<result column="stock" property="stock" javaType="java.lang.Integer"/>
		<result column="item_id" property="itemId" javaType="java.lang.Integer"/>
		<result column="item_type" property="itemType" javaType="java.lang.Integer"/>
		<result column="category_id" property="categoryId" javaType="java.lang.Integer"/>
		<result column="brand_id" property="brandId" javaType="java.lang.Integer"/>
		<result column="like_num" property="like" javaType="java.lang.Integer"/>
	</resultMap>
	
	<!-- 新增商品，商品对象设置的属性都会持久化到数据库 -->
	<insert id="insert">
		insert into 
			hts.item 
			(name, summary, description, world_id, img_path, img_thumb, price, sale, sales, stock, item_id, item_type, link,category_id, brand_id, like_num)
	 	values 
	 		(#{name}, #{summary}, #{description}, #{worldId}, #{imgPath}, #{imgThumb}, #{price}, #{sale}, #{sales}, #{stock}, #{itemId}, #{itemType},"www.baidu.com", #{categoryId}, #{brandId}, #{like})
	</insert>
	
	<!-- 根据id更新商品，可以更新商品对象的所有属性 -->
	<update id="update">
		update 
			hts.item 
		<set>
	      <if test="name != null">name = #{name},</if>
	      <if test="summary != null">summary = #{summary},</if>
	      <if test="description != null">description = #{description},</if>
	      <if test="worldId != null">world_id = #{worldId},</if>
	      <if test="imgPath != null">img_path = #{imgPath},</if>
	      <if test="imgThumb != null">img_thumb = #{imgThumb},</if>
	      <if test="price != null">price = #{price}</if>
	      <if test="sale != null">sale = #{sale}</if>
	      <if test="sales != null">sales = #{sales}</if>
	      <if test="stock != null">stock = #{stock}</if>
	      <if test="itemId != null">item_id = #{itemId}</if>
	      <if test="itemType != null">item_type = #{itemType}</if>
	      <if test="categoryId != null">category_id = #{categoryId}</if>
	      <if test="brandId != null">brand_id = #{brandId}</if>
	      <if test="like != null">like_num = #{like}</if>
	    </set>
	  	where 
	  		id = #{id}
	</update>

	<!-- 根据id删除商品 -->
	<delete id="deleteById">
		delete from hts.item where id = #{id}
	</delete>
	
	<!-- 分页查询商品 -->
	<select id="queryItemList" resultMap="ItemMap">
		select 
			* 
		from 
			hts.item
		<where>
		<if test="name != null">
			name like CONCAT('%',#{name},'%')
		</if>
		<if test="itemSetId != null">
		and id not in(
				select 
					item_id
				from 
					hts.item_set_r
				where 
					item_set_id = #{itemSetId}		
			)
		</if>
		</where>	
		order by id desc
		<include refid="com.imzhitu.admin.common.mapper.NumberMapper.Pagination_Clause"/>
	</select>
	
	<!-- 查询商品总数 -->
	<select id="queryItemTotal" resultType="INTEGER">
		select 
			count(*)
		from 
			hts.item
	</select>
	
	<!--  通过集合ID查询商品 -->
	<select id="queryItemListBySetId" resultMap="ItemMap">
		select 
			hi.* 
		from 
			hts.item hi, hts.item_set_r his
		where
			hi.id =  his.item_id
			and 
			his.item_set_id = #{itemSetId}
	</select>
	
</mapper>